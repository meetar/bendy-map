# by @meetar based on tilt-gotham by @patriciogv - 2015

cameras:
    perspective:
        type: perspective
        vanishing_point: [0, -500]
lights:
    directional1:
        type: directional
        direction: [-1.,-1.,-0.5]
        ambient: .3
        diffuse: .5
        specular: 1.
styles:
    tilt:
        animated: true
        base: polygons
        shaders:
            uniforms:
                u_t: 1.
                u_u: 3.68
                u_v: .001
                u_yoffset: -800.
                u_zoffset: 0.
            blocks:
                global: |
                    mat3 rotateX3D(float phi){
                        return mat3(
                            vec3(1.,0.,0.),
                            vec3(0.,cos(phi),-sin(phi)),
                            vec3(0.,sin(phi),cos(phi))
                            );
                    }
                    mat3 rotateZ3D(float psi){
                        return mat3(
                            vec3(cos(psi),-sin(psi),0.),
                            vec3(sin(psi),cos(psi),0.),
                            vec3(0.,0.,1.)
                            );
                    }
                position: |
                    // float t = u_time*0.05; 
                    float t = 1.;
                    float u = 0.;
                    // position.xyz = rotateX3D(abs(cos(t))) * rotateZ3D(abs(sin(t))*.5) * position.xyz;
                    vec3 new = rotateX3D(cos(u_t)) * rotateZ3D(sin(u_u)) * position.xyz;
                    position.xyz = new.xyz;
                    position.xyz = vec3(new.x, position.y - u_yoffset, new.z*position.y*-1.*u_v - u_zoffset);
   
    roads:
        animated: false
        texcoords: true
        base: lines
        mix: tilt
sources:
    osm:
        type: TopoJSON
        url:  //vector.mapzen.com/osm/all/{z}/{x}/{y}.topojson?api_key=vector-tiles-JUsa0Gc
layers:
    water:
        data: { source: osm }
        draw:
            tilt:
                order: 2
                color: '#353535'
    earth:
        data: { source: osm }
        draw:
            roads:
                order: 0
                color: '#555'
    roads:
        data: { source: osm }
        filter: { not: { highway: service, kind: rail } }
        properties: { width: 3 }
        draw:
            roads:
                order: 3
                color: red
                width: 15
    buildings:
        data: { source: osm }
        draw:
            tilt:
                order: 5
                color: white
                extrude: true
